import React, { useState, useRef, useEffect } from 'react';

const BOT_AVATAR = '/logo.png'; // Using the company logo

// Simple message bubble for bot/user
function ChatMessage({ message, isBot }) {
  return (
    <div style={{
      display: 'flex',
      justifyContent: isBot ? 'flex-start' : 'flex-end',
      alignItems: 'flex-end',
      marginBottom: 12
    }}>
      {isBot && (
        <img
          src={BOT_AVATAR}
          alt="WebStrat Bot"
          style={{
            width: 32,
            height: 32,
            borderRadius: '50%',
            objectFit: 'cover',
            marginRight: 8,
            boxShadow: '0 1px 4px 0 rgba(0,0,0,0.10)'
          }}
        />
      )}
      <div style={{
        background: isBot ? '#f3f4f6' : '#1e40af',
        color: isBot ? '#374151' : 'white',
        borderRadius: 16,
        padding: '10px 16px',
        maxWidth: 320,
        fontSize: 15,
        lineHeight: 1.4,
        boxShadow: isBot ? '0 1px 4px 0 rgba(0,0,0,0.06)' : '0 2px 8px 0 rgba(30,64,175,0.10)',
        alignSelf: isBot ? 'flex-start' : 'flex-end',
        borderBottomLeftRadius: isBot ? 4 : 16,
        borderBottomRightRadius: isBot ? 16 : 4,
        whiteSpace: 'pre-line'
      }}>
        {message}
      </div>
    </div>
  );
}

const webStratResponses = {
  welcome: 'Hi! I\'m the WebStrat AI Assistant. I\'m here to help with your software development and business technology needs. How can I assist you today?',
  placeholder: 'Ask about our services, pricing, or technology solutions...',
  label: 'Need tech help?',
  close: 'Close',
  send: 'Send',
  disclaimer: 'WebStrat AI Assistant is helpful but not perfect - for detailed quotes and project planning, please contact us directly.',
  
  replies: {
    // Core Services
    services: 'We offer comprehensive software solutions:\n\n‚Ä¢ Custom Web Development (React, Next.js, Vue)\n‚Ä¢ AI-Powered Customer Support Systems\n‚Ä¢ Mobile App Development\n‚Ä¢ E-commerce Solutions\n‚Ä¢ Business Growth Consulting\n‚Ä¢ Digital Transformation\n‚Ä¢ UI/UX Design\n‚Ä¢ Software Integration\n‚Ä¢ API Development & Integration\n‚Ä¢ Database Design & Optimization\n\nWhich service interests you most?',
    
    web: 'We specialize in modern web development using cutting-edge technologies:\n\n‚Ä¢ React, Next.js, Vue.js frameworks\n‚Ä¢ Responsive design for all devices\n‚Ä¢ SEO optimization & performance\n‚Ä¢ Progressive Web Apps (PWAs)\n‚Ä¢ Server-side rendering (SSR)\n‚Ä¢ Modern UI/UX design\n‚Ä¢ CMS integration (Strapi, Sanity)\n‚Ä¢ Headless architecture\n‚Ä¢ API-first development\n\nWe build websites that drive business growth.',
    
    ai: 'Our AI-powered solutions include:\n\n‚Ä¢ Intelligent customer support chatbots\n‚Ä¢ Automated response systems\n‚Ä¢ Business process automation\n‚Ä¢ Custom AI integrations\n‚Ä¢ Machine learning solutions\n‚Ä¢ Natural language processing\n‚Ä¢ Predictive analytics\n‚Ä¢ AI-powered recommendations\n‚Ä¢ Document processing automation\n\nThese systems improve efficiency and customer satisfaction.',
    
    mobile: 'We develop high-quality mobile applications:\n\n‚Ä¢ Native iOS and Android apps\n‚Ä¢ Cross-platform solutions (React Native, Flutter)\n‚Ä¢ Progressive Web Apps (PWAs)\n‚Ä¢ App Store optimization\n‚Ä¢ Backend integration & APIs\n‚Ä¢ Push notifications\n‚Ä¢ Offline functionality\n‚Ä¢ Performance optimization\n‚Ä¢ App analytics integration\n\nYour app will work seamlessly across all devices.',
    
    ecommerce: 'Complete e-commerce solutions:\n\n‚Ä¢ Custom online stores\n‚Ä¢ Payment gateway integration (PayFast, Stripe, PayPal)\n‚Ä¢ Inventory management systems\n‚Ä¢ Order processing & fulfillment\n‚Ä¢ Multi-platform selling\n‚Ä¢ Analytics & reporting dashboards\n‚Ä¢ Customer management (CRM)\n‚Ä¢ Marketing automation\n‚Ä¢ Multi-currency support\n‚Ä¢ B2B & B2C solutions\n\nWe help you sell more online and grow your business.',
    
    // Pricing & Business
    pricing: 'Our pricing is transparent and project-based:\n\nüí∞ WEBSITE PACKAGES:\n‚Ä¢ Basic Website: R15,000 - R30,000\n‚Ä¢ Business Website: R30,000 - R60,000\n‚Ä¢ E-commerce Store: R50,000 - R120,000\n‚Ä¢ Custom Web App: R80,000 - R250,000+\n\nüì± MOBILE APPS:\n‚Ä¢ Simple App: R60,000 - R120,000\n‚Ä¢ Advanced App: R120,000 - R300,000+\n\nü§ñ AI SOLUTIONS:\n‚Ä¢ Chatbot Integration: R25,000 - R80,000\n‚Ä¢ Custom AI System: R100,000+\n\nContact us at +27 82 387 4406 for a detailed quote!',
    
    payment: 'We offer flexible payment options:\n\n‚Ä¢ 50% deposit to start project\n‚Ä¢ 50% on completion\n‚Ä¢ Monthly payment plans available\n‚Ä¢ Milestone-based payments for large projects\n‚Ä¢ All major payment methods accepted\n‚Ä¢ Secure online invoicing\n\nWe make it easy to work with us financially.',
    
    timeline: 'Realistic project timelines:\n\n‚è∞ WEBSITES:\n‚Ä¢ Landing Page: 1-2 weeks\n‚Ä¢ Business Website: 2-4 weeks\n‚Ä¢ E-commerce Store: 4-8 weeks\n‚Ä¢ Custom Web App: 6-12 weeks\n\nüì± MOBILE APPS:\n‚Ä¢ Simple App: 8-12 weeks\n‚Ä¢ Complex App: 12-20 weeks\n\nü§ñ AI SOLUTIONS:\n‚Ä¢ Basic Chatbot: 2-3 weeks\n‚Ä¢ Advanced AI System: 6-16 weeks\n\nWe provide accurate timelines after understanding your requirements.',
    
    // Technology Deep Dive
    tech: 'We work with modern, proven technologies:\n\nüåê FRONTEND:\n‚Ä¢ React, Next.js, Vue.js, Nuxt.js\n‚Ä¢ TypeScript, JavaScript ES6+\n‚Ä¢ Tailwind CSS, Material-UI, Chakra UI\n‚Ä¢ Responsive & Mobile-First Design\n\n‚öôÔ∏è BACKEND:\n‚Ä¢ Node.js, Express.js, Fastify\n‚Ä¢ Python (Django, FastAPI)\n‚Ä¢ PHP (Laravel, Symfony)\n‚Ä¢ REST APIs & GraphQL\n\nüóÑÔ∏è DATABASES:\n‚Ä¢ PostgreSQL, MySQL, MongoDB\n‚Ä¢ Redis for caching\n‚Ä¢ Prisma, Mongoose ODM\n\n‚òÅÔ∏è CLOUD & HOSTING:\n‚Ä¢ AWS, Google Cloud, Azure\n‚Ä¢ Netlify, Vercel, Railway\n‚Ä¢ Docker containerization\n‚Ä¢ CI/CD pipelines\n\nWe choose the best tech stack for your project.',
    
    frontend: 'Our frontend expertise includes:\n\n‚Ä¢ React.js with hooks & context\n‚Ä¢ Next.js for SSR/SSG\n‚Ä¢ Vue.js & Nuxt.js\n‚Ä¢ TypeScript for type safety\n‚Ä¢ State management (Redux, Zustand)\n‚Ä¢ Modern CSS (Tailwind, Styled Components)\n‚Ä¢ Progressive Web Apps (PWAs)\n‚Ä¢ Component libraries & design systems\n‚Ä¢ Performance optimization\n‚Ä¢ Accessibility (WCAG compliance)\n\nWe create beautiful, fast, and user-friendly interfaces.',
    
    backend: 'Backend development services:\n\n‚Ä¢ RESTful API design & development\n‚Ä¢ GraphQL APIs\n‚Ä¢ Microservices architecture\n‚Ä¢ Database design & optimization\n‚Ä¢ Authentication & authorization\n‚Ä¢ File storage & CDN integration\n‚Ä¢ Third-party API integrations\n‚Ä¢ Background job processing\n‚Ä¢ Performance monitoring\n‚Ä¢ Security best practices\n\nRobust, scalable backend solutions.',
    
    database: 'Database solutions we provide:\n\n‚Ä¢ PostgreSQL for complex queries\n‚Ä¢ MongoDB for flexible schemas\n‚Ä¢ MySQL for traditional apps\n‚Ä¢ Redis for caching & sessions\n‚Ä¢ Database design & normalization\n‚Ä¢ Performance optimization\n‚Ä¢ Backup & recovery strategies\n‚Ä¢ Data migration services\n‚Ä¢ Analytics & reporting\n‚Ä¢ Real-time data processing\n\nYour data is safe and accessible.',
    
    // Specialized Services
    seo: 'SEO & Performance optimization:\n\n‚Ä¢ Technical SEO audits\n‚Ä¢ Page speed optimization\n‚Ä¢ Core Web Vitals improvement\n‚Ä¢ Meta tags & structured data\n‚Ä¢ Sitemap & robots.txt setup\n‚Ä¢ Google Analytics integration\n‚Ä¢ Search Console setup\n‚Ä¢ Local SEO optimization\n‚Ä¢ Content optimization guidance\n‚Ä¢ Performance monitoring\n\nGet found online and rank higher.',
    
    security: 'Security measures we implement:\n\n‚Ä¢ SSL certificates & HTTPS\n‚Ä¢ Input validation & sanitization\n‚Ä¢ SQL injection prevention\n‚Ä¢ XSS protection\n‚Ä¢ CSRF protection\n‚Ä¢ Rate limiting\n‚Ä¢ Secure authentication\n‚Ä¢ Data encryption\n‚Ä¢ Regular security audits\n‚Ä¢ Compliance with data protection laws\n\nYour website and data are secure.',
    
    cms: 'Content Management Solutions:\n\n‚Ä¢ WordPress custom development\n‚Ä¢ Headless CMS (Strapi, Sanity)\n‚Ä¢ Custom admin panels\n‚Ä¢ User-friendly editing interfaces\n‚Ä¢ Multi-user permissions\n‚Ä¢ Content scheduling\n‚Ä¢ Media management\n‚Ä¢ SEO-friendly content structure\n‚Ä¢ Multi-language support\n‚Ä¢ Easy content updates\n\nManage your content with ease.',
    
    integration: 'Third-party integrations we handle:\n\n‚Ä¢ Payment gateways (PayFast, Stripe)\n‚Ä¢ CRM systems (HubSpot, Salesforce)\n‚Ä¢ Email marketing (Mailchimp, SendGrid)\n‚Ä¢ Social media APIs\n‚Ä¢ Accounting software (Xero, QuickBooks)\n‚Ä¢ Shipping providers\n‚Ä¢ Analytics tools\n‚Ä¢ Communication platforms\n‚Ä¢ Inventory management\n‚Ä¢ Custom API development\n\nConnect all your business tools.',
    
    // Support & Maintenance
    support: 'Comprehensive support services:\n\n‚Ä¢ 24/7 website monitoring\n‚Ä¢ Regular security updates\n‚Ä¢ Performance optimization\n‚Ä¢ Bug fixes & troubleshooting\n‚Ä¢ Content updates\n‚Ä¢ Feature enhancements\n‚Ä¢ Backup management\n‚Ä¢ Uptime monitoring\n‚Ä¢ Technical support\n‚Ä¢ Emergency response\n\nWe keep your systems running smoothly.',
    
    maintenance: 'Website maintenance packages:\n\nüîß BASIC PLAN (R2,000/month):\n‚Ä¢ Security updates\n‚Ä¢ Backup management\n‚Ä¢ Basic support\n\n‚ö° STANDARD PLAN (R4,000/month):\n‚Ä¢ Everything in Basic\n‚Ä¢ Content updates\n‚Ä¢ Performance monitoring\n‚Ä¢ Priority support\n\nüöÄ PREMIUM PLAN (R8,000/month):\n‚Ä¢ Everything in Standard\n‚Ä¢ Feature development\n‚Ä¢ Advanced analytics\n‚Ä¢ 24/7 monitoring\n\nChoose the plan that fits your needs.',
    
    hosting: 'Hosting solutions we recommend:\n\n‚Ä¢ Cloud hosting (AWS, Google Cloud)\n‚Ä¢ Managed WordPress hosting\n‚Ä¢ CDN setup (Cloudflare)\n‚Ä¢ SSL certificates included\n‚Ä¢ Automatic backups\n‚Ä¢ 99.9% uptime guarantee\n‚Ä¢ Global server locations\n‚Ä¢ DDoS protection\n‚Ä¢ Performance optimization\n‚Ä¢ 24/7 monitoring\n\nFast, secure, and reliable hosting.',
    
    // Business & Consultation
    consultation: 'Free consultation includes:\n\n‚Ä¢ Project requirements analysis\n‚Ä¢ Technology recommendations\n‚Ä¢ Architecture planning\n‚Ä¢ Cost estimation\n‚Ä¢ Timeline discussion\n‚Ä¢ Risk assessment\n‚Ä¢ Strategy development\n‚Ä¢ ROI projections\n‚Ä¢ Competitive analysis\n‚Ä¢ Implementation roadmap\n\nBook your free 30-minute consultation today!',
    
    strategy: 'Digital strategy services:\n\n‚Ä¢ Digital transformation planning\n‚Ä¢ Technology roadmap development\n‚Ä¢ Business process analysis\n‚Ä¢ Competitive research\n‚Ä¢ User experience strategy\n‚Ä¢ Growth hacking techniques\n‚Ä¢ Conversion optimization\n‚Ä¢ Analytics implementation\n‚Ä¢ KPI tracking setup\n‚Ä¢ Long-term planning\n\nAlign technology with your business goals.',
    
    training: 'Training services we offer:\n\n‚Ä¢ Website management training\n‚Ä¢ CMS usage tutorials\n‚Ä¢ SEO best practices\n‚Ä¢ Social media integration\n‚Ä¢ Analytics interpretation\n‚Ä¢ Content creation guidance\n‚Ä¢ Digital marketing basics\n‚Ä¢ E-commerce management\n‚Ä¢ Security awareness\n‚Ä¢ Custom training programs\n\nEmpower your team with knowledge.',
    
    // Industries & Specializations
    industries: 'Industries we serve:\n\n‚Ä¢ Professional Services\n‚Ä¢ E-commerce & Retail\n‚Ä¢ Healthcare & Medical\n‚Ä¢ Education & Training\n‚Ä¢ Real Estate\n‚Ä¢ Hospitality & Tourism\n‚Ä¢ Manufacturing\n‚Ä¢ Non-profit Organizations\n‚Ä¢ Financial Services\n‚Ä¢ Technology Startups\n\nWe understand your industry\'s unique needs.',
    
    startup: 'Startup-friendly solutions:\n\n‚Ä¢ MVP development\n‚Ä¢ Scalable architecture\n‚Ä¢ Cost-effective solutions\n‚Ä¢ Rapid prototyping\n‚Ä¢ Lean development approach\n‚Ä¢ Growth-focused features\n‚Ä¢ Investor-ready presentations\n‚Ä¢ Technical due diligence\n‚Ä¢ Startup mentoring\n‚Ä¢ Flexible payment terms\n\nHelping startups succeed with technology.',
    
    enterprise: 'Enterprise solutions:\n\n‚Ä¢ Large-scale system architecture\n‚Ä¢ Legacy system modernization\n‚Ä¢ Enterprise integrations\n‚Ä¢ Compliance & security\n‚Ä¢ Scalability planning\n‚Ä¢ Team augmentation\n‚Ä¢ Technical leadership\n‚Ä¢ Code review & auditing\n‚Ä¢ Performance optimization\n‚Ä¢ 24/7 enterprise support\n\nEnterprise-grade solutions.',
    
    // Location & Remote Work
    location: 'We\'re based in South Africa but serve clients globally:\n\nüåç LOCATIONS:\n‚Ä¢ Western Cape (Cape Town)\n‚Ä¢ Gauteng (Johannesburg)\n‚Ä¢ Remote collaboration worldwide\n\nüíº REMOTE SERVICES:\n‚Ä¢ Video conferencing (Zoom, Teams)\n‚Ä¢ Project management tools\n‚Ä¢ Regular progress updates\n‚Ä¢ Flexible timezone support\n‚Ä¢ Cultural sensitivity\n‚Ä¢ Clear communication\n\nDistance is no barrier to great results.',
    
    remote: 'Our remote work process:\n\n‚Ä¢ Daily standups & progress updates\n‚Ä¢ Screen sharing & collaboration\n‚Ä¢ Cloud-based development\n‚Ä¢ Version control (Git)\n‚Ä¢ Project management tools\n‚Ä¢ Time tracking & reporting\n‚Ä¢ Regular video calls\n‚Ä¢ Shared documentation\n‚Ä¢ Agile methodology\n‚Ä¢ Transparent communication\n\nSeamless remote collaboration.',
    
    // Process & Methodology
    process: 'Our proven development process:\n\n1Ô∏è‚É£ DISCOVERY & PLANNING\n‚Ä¢ Requirements gathering\n‚Ä¢ User research\n‚Ä¢ Technical analysis\n‚Ä¢ Project planning\n\n2Ô∏è‚É£ DESIGN & PROTOTYPING\n‚Ä¢ UI/UX design\n‚Ä¢ Wireframing\n‚Ä¢ Prototyping\n‚Ä¢ Client approval\n\n3Ô∏è‚É£ DEVELOPMENT\n‚Ä¢ Agile sprints\n‚Ä¢ Regular testing\n‚Ä¢ Code reviews\n‚Ä¢ Progress updates\n\n4Ô∏è‚É£ TESTING & LAUNCH\n‚Ä¢ Quality assurance\n‚Ä¢ User testing\n‚Ä¢ Deployment\n‚Ä¢ Post-launch support\n\nWe keep you involved throughout.',
    
    methodology: 'Development methodologies we use:\n\n‚Ä¢ Agile/Scrum development\n‚Ä¢ Test-driven development (TDD)\n‚Ä¢ Continuous integration/deployment\n‚Ä¢ Code review processes\n‚Ä¢ Version control (Git)\n‚Ä¢ Documentation standards\n‚Ä¢ Quality assurance\n‚Ä¢ Performance testing\n‚Ä¢ Security testing\n‚Ä¢ User acceptance testing\n\nBest practices for quality results.',
    
    testing: 'Quality assurance process:\n\n‚Ä¢ Automated testing suites\n‚Ä¢ Manual testing procedures\n‚Ä¢ Cross-browser testing\n‚Ä¢ Mobile responsiveness testing\n‚Ä¢ Performance testing\n‚Ä¢ Security vulnerability scanning\n‚Ä¢ User acceptance testing\n‚Ä¢ Load testing\n‚Ä¢ Accessibility testing\n‚Ä¢ Code quality reviews\n\nEnsuring everything works perfectly.',
    
    // Contact & Getting Started
    contact: 'Multiple ways to reach us:\n\nüìû PHONE: +27 82 387 4406\nüìß EMAIL: jacques@webstratit.co.za\nüåê WEBSITE: Contact form on this site\nüí¨ WHATSAPP: Business inquiries welcome\nüìÖ CALENDLY: Schedule a meeting\nüè¢ OFFICE: Available for local meetings\n\n‚è∞ RESPONSE TIME: Within 24 hours\nüïê AVAILABILITY: 24/7 for urgent matters\n\nWe\'re here to help!',
    
    start: 'Ready to start your project? Here\'s how:\n\n1Ô∏è‚É£ INITIAL CONTACT\n‚Ä¢ Call, email, or use contact form\n‚Ä¢ Brief project discussion\n\n2Ô∏è‚É£ FREE CONSULTATION\n‚Ä¢ 30-minute strategy session\n‚Ä¢ Requirements analysis\n‚Ä¢ Technology recommendations\n\n3Ô∏è‚É£ PROPOSAL & QUOTE\n‚Ä¢ Detailed project proposal\n‚Ä¢ Transparent pricing\n‚Ä¢ Timeline estimation\n\n4Ô∏è‚É£ PROJECT KICKOFF\n‚Ä¢ Contract signing\n‚Ä¢ Deposit payment\n‚Ä¢ Development begins\n\nLet\'s transform your business with technology!',
    
    meeting: 'Schedule a meeting with us:\n\n‚Ä¢ Free 30-minute consultation\n‚Ä¢ Project discussion\n‚Ä¢ Technology recommendations\n‚Ä¢ Q&A session\n‚Ä¢ No obligation\n‚Ä¢ Available via video call\n‚Ä¢ Flexible scheduling\n‚Ä¢ Same-day availability often possible\n\nReady to discuss your project?',
    
    // Portfolio & Experience
    portfolio: 'Our successful projects include:\n\nüåê WEBSITES:\n‚Ä¢ Corporate websites & portfolios\n‚Ä¢ E-commerce platforms\n‚Ä¢ SaaS applications\n‚Ä¢ Non-profit websites\n\nüì± MOBILE APPS:\n‚Ä¢ Business productivity apps\n‚Ä¢ E-commerce mobile apps\n‚Ä¢ Social networking platforms\n‚Ä¢ Utility applications\n\nü§ñ AI SOLUTIONS:\n‚Ä¢ Customer service chatbots\n‚Ä¢ Business automation systems\n‚Ä¢ Data analysis platforms\n\nContact us to see examples relevant to your industry.',
    
    experience: 'Our team\'s experience:\n\n‚Ä¢ 5+ years in web development\n‚Ä¢ 100+ successful projects\n‚Ä¢ Diverse industry experience\n‚Ä¢ Modern technology expertise\n‚Ä¢ Agile methodology certified\n‚Ä¢ Continuous learning culture\n‚Ä¢ Client satisfaction focused\n‚Ä¢ Problem-solving specialists\n‚Ä¢ Innovation-driven approach\n‚Ä¢ Quality-first mindset\n\nExperience you can trust.',
    
    testimonials: 'What our clients say:\n\n"WebStrat delivered exactly what we needed, on time and within budget. Their communication was excellent throughout the project." - Local Business Owner\n\n"The AI chatbot they built has transformed our customer service. Highly recommended!" - E-commerce Client\n\n"Professional, knowledgeable, and great to work with." - Startup Founder\n\nWe pride ourselves on client satisfaction.',
    
    // General Help
    help: 'I can assist you with:\n\n‚Ä¢ Service information & pricing\n‚Ä¢ Technology recommendations\n‚Ä¢ Project planning & timelines\n‚Ä¢ Getting started process\n‚Ä¢ Technical questions\n‚Ä¢ Portfolio examples\n‚Ä¢ Scheduling consultations\n‚Ä¢ Business strategy\n‚Ä¢ Digital transformation\n‚Ä¢ Any other questions\n\nWhat specific help do you need?',
    
    thanks: 'Thank you for your interest in WebStrat!\n\n‚Ä¢ We appreciate you considering us\n‚Ä¢ Your business success is our priority\n‚Ä¢ We\'re committed to excellence\n‚Ä¢ Quality results guaranteed\n‚Ä¢ Transparent communication always\n‚Ä¢ Long-term partnership focused\n\nHow else can I help you today?',
    
    goodbye: 'Thanks for chatting with WebStrat!\n\n‚Ä¢ Remember: Free consultation available\n‚Ä¢ Contact us anytime at +27 82 387 4406\n‚Ä¢ Email: jacques@webstratit.co.za\n‚Ä¢ We respond within 24 hours\n‚Ä¢ Your success is our mission\n\nLooking forward to working with you!',
    
    fallback: 'I can help with information about:\n\nüîß SERVICES:\n‚Ä¢ Web development & design\n‚Ä¢ Mobile app development\n‚Ä¢ AI solutions & chatbots\n‚Ä¢ E-commerce platforms\n‚Ä¢ Digital transformation\n\nüí∞ BUSINESS:\n‚Ä¢ Pricing & packages\n‚Ä¢ Project timelines\n‚Ä¢ Free consultations\n‚Ä¢ Getting started\n\nüõ†Ô∏è TECHNICAL:\n‚Ä¢ Technologies we use\n‚Ä¢ Hosting & maintenance\n‚Ä¢ Security & performance\n‚Ä¢ Integrations & APIs\n\nWhat would you like to know more about?'
  }
};

export default function WebStratChatbot() {
  const [open, setOpen] = useState(false);
  const [messages, setMessages] = useState([
    { text: webStratResponses.welcome, isBot: true }
  ]);
  const [input, setInput] = useState('');
  const [showLabel, setShowLabel] = useState(false);
  const messagesEndRef = useRef(null);

  useEffect(() => {
    if (open && messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages, open]);

  // Show label after 5 seconds if chat is closed
  useEffect(() => {
    if (!open) {
      const timer = setTimeout(() => setShowLabel(true), 5000);
      return () => clearTimeout(timer);
    } else {
      setShowLabel(false);
    }
  }, [open]);

  const handleSend = () => {
    if (!input.trim()) return;
    setMessages((msgs) => [...msgs, { text: input, isBot: false }]);
    setTimeout(() => {
      setMessages((msgs) => [
        ...msgs,
        { text: getBotReply(input), isBot: true }
      ]);
    }, 600);
    setInput('');
  };

  function getBotReply(userMsg) {
    const text = userMsg.toLowerCase().trim();
    
    // Intent patterns for WebStrat services
    const intentPatterns = [
      // Core Services
      { pattern: /what.*service|service.*offer|what.*do.*you.*do|solutions/i, category: 'services' },
      { pattern: /web.*development|website.*develop|build.*website|web.*design/i, category: 'web' },
      { pattern: /ai.*support|chatbot|artificial.*intelligence|automation|machine.*learning/i, category: 'ai' },
      { pattern: /mobile.*app|app.*development|ios.*android|react.*native/i, category: 'mobile' },
      { pattern: /ecommerce|e-commerce|online.*store|shop.*online|selling.*online/i, category: 'ecommerce' },
      
      // Pricing and Business
      { pattern: /how.*much.*cost|price|pricing|budget|quote|expensive|cheap|afford/i, category: 'pricing' },
      { pattern: /payment.*plan|payment.*option|how.*pay|payment.*method/i, category: 'payment' },
      { pattern: /how.*long|timeline|time.*take|duration|when.*ready|how.*fast/i, category: 'timeline' },
      
      // Technology Deep Dive
      { pattern: /technology|tech.*stack|framework|language|database|cloud/i, category: 'tech' },
      { pattern: /frontend|front.*end|react|vue|angular|javascript|typescript/i, category: 'frontend' },
      { pattern: /backend|back.*end|api|server|node|python|php/i, category: 'backend' },
      { pattern: /database|sql|nosql|mongodb|postgresql|mysql/i, category: 'database' },
      
      // Specialized Services
      { pattern: /seo|search.*optimization|google|ranking|performance/i, category: 'seo' },
      { pattern: /security|secure|ssl|https|protection|vulnerability/i, category: 'security' },
      { pattern: /cms|content.*management|wordpress|admin.*panel/i, category: 'cms' },
      { pattern: /integration|third.*party|api.*integration|connect.*system/i, category: 'integration' },
      
      // Support and Maintenance
      { pattern: /support|maintenance|after.*launch|ongoing|help.*after/i, category: 'support' },
      { pattern: /maintenance.*plan|maintenance.*package|monthly.*support/i, category: 'maintenance' },
      { pattern: /hosting|server|domain|uptime|cloud.*hosting/i, category: 'hosting' },
      
      // Business and Consultation
      { pattern: /consultation|consult|meeting|discuss|talk|advice/i, category: 'consultation' },
      { pattern: /strategy|digital.*transformation|business.*strategy|planning/i, category: 'strategy' },
      { pattern: /training|learn|teach|how.*to.*use|tutorial/i, category: 'training' },
      
      // Industries and Specializations
      { pattern: /industry|sector|business.*type|work.*with/i, category: 'industries' },
      { pattern: /startup|mvp|minimum.*viable|early.*stage|entrepreneur/i, category: 'startup' },
      { pattern: /enterprise|large.*company|corporation|big.*business/i, category: 'enterprise' },
      
      // Location and Remote
      { pattern: /location|where.*located|office|based|local/i, category: 'location' },
      { pattern: /remote|work.*remotely|online.*collaboration|virtual/i, category: 'remote' },
      
      // Process and Methodology
      { pattern: /process|how.*work|methodology|approach|steps/i, category: 'process' },
      { pattern: /agile|scrum|methodology|development.*process/i, category: 'methodology' },
      { pattern: /testing|quality.*assurance|qa|test.*website/i, category: 'testing' },
      
      // Contact and Getting Started
      { pattern: /contact|phone|email|reach.*you|get.*in.*touch/i, category: 'contact' },
      { pattern: /get.*started|start.*project|begin|ready.*to.*start/i, category: 'start' },
      { pattern: /meeting|schedule|appointment|call|video.*call/i, category: 'meeting' },
      
      // Portfolio and Experience
      { pattern: /portfolio|example|work.*done|previous.*project|show.*me/i, category: 'portfolio' },
      { pattern: /experience|years.*experience|team.*experience|expertise/i, category: 'experience' },
      { pattern: /testimonial|review|client.*feedback|what.*clients.*say/i, category: 'testimonials' },
      
      // Greetings and General
      { pattern: /hello|hi|hey|good.*morning|good.*afternoon|greetings/i, category: 'welcome' },
      { pattern: /help|assistance|support.*me|can.*you.*help/i, category: 'help' },
      { pattern: /thank|thanks|appreciate|grateful/i, category: 'thanks' },
      { pattern: /bye|goodbye|see.*you|farewell|chat.*later/i, category: 'goodbye' }
    ];

    // Check intent patterns first
    for (const { pattern, category } of intentPatterns) {
      if (pattern.test(text)) {
        return webStratResponses.replies[category] || webStratResponses.replies.fallback;
      }
    }

    // Enhanced keyword matching as fallback
    const keywordCategories = {
      // Core Services
      services: ['service', 'services', 'offer', 'solutions', 'what do you do', 'capabilities'],
      web: ['website', 'web', 'frontend', 'react', 'nextjs', 'vue', 'design'],
      ai: ['ai', 'artificial intelligence', 'chatbot', 'automation', 'machine learning', 'smart'],
      mobile: ['mobile', 'app', 'ios', 'android', 'react native', 'flutter', 'application'],
      ecommerce: ['ecommerce', 'e-commerce', 'store', 'shop', 'sell online', 'selling'],
      
      // Pricing and Business
      pricing: ['price', 'cost', 'budget', 'quote', 'expensive', 'cheap', 'affordable', 'money'],
      payment: ['payment', 'pay', 'billing', 'invoice', 'deposit', 'installments'],
      timeline: ['timeline', 'time', 'duration', 'how long', 'when', 'delivery', 'deadline'],
      
      // Technology
      tech: ['technology', 'tech', 'framework', 'database', 'cloud', 'tools'],
      frontend: ['frontend', 'front-end', 'ui', 'user interface', 'client-side'],
      backend: ['backend', 'back-end', 'server', 'api', 'database'],
      database: ['database', 'data storage', 'sql', 'nosql', 'mongodb'],
      
      // Specialized Services
      seo: ['seo', 'search optimization', 'google', 'ranking', 'visibility'],
      security: ['security', 'secure', 'ssl', 'protection', 'safe'],
      cms: ['cms', 'content management', 'wordpress', 'admin'],
      integration: ['integration', 'connect', 'third party', 'api'],
      
      // Support
      support: ['support', 'maintenance', 'help', 'ongoing', 'after launch'],
      maintenance: ['maintenance plan', 'monthly support', 'updates'],
      hosting: ['hosting', 'server', 'domain', 'uptime'],
      
      // Business
      consultation: ['consultation', 'meeting', 'discuss', 'advice', 'consult'],
      strategy: ['strategy', 'planning', 'digital transformation'],
      training: ['training', 'learn', 'teach', 'tutorial'],
      
      // Specializations
      industries: ['industry', 'sector', 'business type'],
      startup: ['startup', 'mvp', 'entrepreneur', 'early stage'],
      enterprise: ['enterprise', 'large company', 'corporation'],
      
      // Location
      location: ['location', 'where', 'office', 'based', 'local'],
      remote: ['remote', 'online', 'virtual', 'distance'],
      
      // Process
      process: ['process', 'methodology', 'approach', 'how you work'],
      methodology: ['agile', 'scrum', 'development process'],
      testing: ['testing', 'quality', 'qa', 'test'],
      
      // Contact
      contact: ['contact', 'phone', 'email', 'reach'],
      start: ['start', 'begin', 'get started', 'ready'],
      meeting: ['meeting', 'schedule', 'appointment', 'call'],
      
      // Portfolio
      portfolio: ['portfolio', 'examples', 'work', 'projects', 'showcase'],
      experience: ['experience', 'expertise', 'years', 'team'],
      testimonials: ['testimonials', 'reviews', 'feedback', 'clients say'],
      
      // General
      help: ['help', 'assistance', 'support me'],
      thanks: ['thank', 'thanks', 'appreciate'],
      goodbye: ['bye', 'goodbye', 'see you', 'farewell']
    };

    let bestMatch = 'fallback';
    let maxMatches = 0;

    for (const [category, keywords] of Object.entries(keywordCategories)) {
      const matches = keywords.filter(keyword => text.includes(keyword)).length;
      if (matches > maxMatches) {
        maxMatches = matches;
        bestMatch = category;
      }
    }

    return webStratResponses.replies[bestMatch] || webStratResponses.replies.fallback;
  }

  return (
    <div style={{ position: 'fixed', bottom: 32, right: 32, zIndex: 1000 }}>
      {/* Floating label */}
      {!open && showLabel && (
        <div className="chatbot-label-anim" style={{
          position: 'absolute',
          bottom: 70,
          right: 0,
          background: 'white',
          color: '#374151',
          borderRadius: 16,
          boxShadow: '0 2px 8px 0 rgba(0,0,0,0.10)',
          padding: '8px 18px',
          fontWeight: 600,
          fontSize: 16,
          marginBottom: 8,
          letterSpacing: 0.1,
          border: '1px solid #e5e7eb',
          opacity: 1,
          transform: 'translateY(0)'
        }}>
          {webStratResponses.label}
        </div>
      )}

      {open ? (
        <div style={{
          boxShadow: '0 8px 32px 0 rgba(0,0,0,0.25)',
          width: '95vw',
          maxWidth: 360,
          height: 600,
          minHeight: 600,
          borderRadius: 12,
          background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'stretch',
          position: 'relative',
          overflow: 'hidden',
        }}>
          {/* Header */}
          <div style={{
            width: '100%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            fontWeight: 800,
            fontSize: 18,
            letterSpacing: 0.5,
            color: '#1e40af',
            padding: '18px 12px 6px 18px',
            fontFamily: 'system-ui, sans-serif',
            borderTopLeftRadius: 12,
            borderTopRightRadius: 12,
            background: 'white',
            borderBottom: '1px solid #e5e7eb',
            userSelect: 'none',
          }}>
            <span style={{flex: 1, textAlign: 'left'}}>WebStrat Assistant</span>
            <button
              onClick={() => setOpen(false)}
              style={{
                background: '#1e40af',
                color: 'white',
                border: 'none',
                borderRadius: 6,
                padding: '6px 12px',
                marginLeft: 12,
                cursor: 'pointer',
                fontWeight: 'bold',
                fontSize: 14,
              }}
            >
              {webStratResponses.close}
            </button>
          </div>

          {/* Messages */}
          <div
            style={{
              flex: 1,
              overflowY: 'auto',
              padding: 24,
              paddingBottom: 0,
              minHeight: 0,
            }}
            className="custom-chat-scroll"
          >
            <style>{`
              .custom-chat-scroll::-webkit-scrollbar {
                width: 12px;
                background: #f1f5f9;
                border-radius: 8px;
              }
              .custom-chat-scroll::-webkit-scrollbar-thumb {
                background: #1e40af;
                border-radius: 8px;
                border: 2px solid #f1f5f9;
              }
              .custom-chat-scroll {
                scrollbar-width: auto;
                scrollbar-color: #1e40af #f1f5f9;
              }
            `}</style>
            {messages.map((msg, i) => (
              <ChatMessage key={i} message={msg.text} isBot={msg.isBot} />
            ))}
            <div ref={messagesEndRef} />
          </div>

          {/* Input */}
          <div style={{ 
            display: 'flex', 
            padding: 16, 
            borderTop: '1px solid #e5e7eb', 
            background: '#fafafa', 
            marginTop: 'auto' 
          }}>
            <input
              type="text"
              value={input}
              onChange={e => setInput(e.target.value)}
              onKeyDown={e => e.key === 'Enter' && handleSend()}
              placeholder={webStratResponses.placeholder}
              style={{ 
                flex: 1, 
                border: '1px solid #d1d5db', 
                borderRadius: 8, 
                padding: '8px 12px', 
                fontSize: 15, 
                marginRight: 8,
                outline: 'none',
                ':focus': { borderColor: '#1e40af' }
              }}
            />
            <button 
              onClick={handleSend} 
              style={{ 
                background: '#1e40af', 
                color: 'white', 
                border: 'none', 
                borderRadius: 8, 
                padding: '8px 18px', 
                fontWeight: 'bold', 
                fontSize: 15, 
                cursor: 'pointer' 
              }}
            >
              {webStratResponses.send}
            </button>
          </div>

          {/* Disclaimer */}
          <div style={{ 
            padding: '8px 16px', 
            fontSize: '11px', 
            color: '#6b7280', 
            textAlign: 'center', 
            borderTop: '1px solid #f0f0f0',
            backgroundColor: '#fafafa',
            borderRadius: '0 0 12px 12px'
          }}>
            {webStratResponses.disclaimer}
          </div>
        </div>
      ) : (
        <button
          onClick={() => setOpen(true)}
          style={{
            background: '#1e40af',
            color: 'white',
            border: 'none',
            borderRadius: '50%',
            width: 56,
            height: 56,
            boxShadow: '0 4px 16px 0 rgba(30, 64, 175, 0.3)',
            fontSize: 28,
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            padding: 0,
            animation: 'chatbot-bounce 1.6s infinite',
            overflow: 'visible',
          }}
          aria-label="Open WebStrat chatbot"
        >
          <img 
            src={BOT_AVATAR} 
            alt="WebStrat Bot" 
            style={{ 
              width: 40, 
              height: 40, 
              borderRadius: '50%', 
              objectFit: 'contain'
            }} 
          />
        </button>
      )}

      <style>{`
        @keyframes chatbot-bounce {
          0%, 100% { transform: translateY(0); }
          20% { transform: translateY(-10px); }
          40% { transform: translateY(0); }
          60% { transform: translateY(-6px); }
          80% { transform: translateY(0); }
        }
        .chatbot-label-anim {
          opacity: 0;
          transform: translateY(40px);
          animation: chatbotLabelBounceIn 1.2s cubic-bezier(.68,-0.55,.27,1.55) 0.1s forwards;
        }
        @keyframes chatbotLabelBounceIn {
          0% {
            opacity: 0;
            transform: translateY(40px) scale(0.8);
          }
          60% {
            opacity: 1;
            transform: translateY(-10px) scale(1.05);
          }
          80% {
            transform: translateY(4px) scale(0.98);
          }
          100% {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
      `}</style>
    </div>
  );
}
